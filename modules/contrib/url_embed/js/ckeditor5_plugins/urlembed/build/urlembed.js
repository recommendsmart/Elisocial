!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.urlembed=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/widget.js":(e,t,r)=>{e.exports=r("dll-reference CKEditor5.dll")("./src/widget.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var i={};return(()=>{"use strict";r.d(i,{default:()=>a});var e=r("ckeditor5/src/core.js"),t=r("ckeditor5/src/widget.js");class n extends e.Command{refresh(){const e=this.editor.model.document.selection.getSelectedElement();null===e||"drupalUrl"==e.name?this.isEnabled=!0:this.isEnabled=!1}execute(e){const{model:t}=this.editor,r=this.editor.plugins.get("UrlEmbedEditing"),i=Object.entries(r.attrs).reduce(((e,[t,r])=>(e[r]=t,e)),{}),n=Object.keys(e).reduce(((t,r)=>(i[r]&&(t[i[r]]=e[r]),t)),{});t.change((e=>{t.insertContent(e.createElement("drupalUrl",n))}))}}class o extends e.Plugin{static get pluginName(){return"UrlEmbedEditing"}static get requires(){return[t.Widget]}init(){this.attrs={url:"data-embed-url",provider:"data-url-provider"};const e=this.editor.config.get("urlEmbed");e&&(this.options=e,this.labelError=Drupal.t("Preview failed"),this.previewError=`\n      <p>${Drupal.t("An error occurred while trying to preview the embedded content. Please save your work and reload this page.")}<p>\n    `,this._defineSchema(),this._defineConverters(),this.editor.commands.add("urlembed",new n(this.editor)))}_defineSchema(){this.editor.model.schema.register("drupalUrl",{isObject:!0,isContent:!0,isBlock:!0,allowWhere:"$block",allowAttributes:Object.keys(this.attrs)}),this.editor.editing.view.domConverter.blockElements.push("drupal-url")}_defineConverters(){const{conversion:e}=this.editor;e.for("upcast").elementToElement({model:"drupalUrl",view:{name:"drupal-url"}}),e.for("dataDowncast").elementToElement({model:"drupalUrl",view:{name:"drupal-url"}}),e.for("editingDowncast").elementToElement({model:"drupalUrl",view:(e,{writer:r})=>{const i=r.createContainerElement("figure",{class:"drupal-url"});return r.setCustomProperty("drupalUrl",!0,i),(0,t.toWidget)(i,r,{label:Drupal.t("Url Embed widget")})}}).add((e=>(e.on("attribute:url:drupalUrl",((e,t,r)=>{const i=r.writer,n=t.item,o=r.mapper.toViewElement(t.item);let l=this._getPreviewContainer(o.getChildren());if(l){if("ready"!==l.getAttribute("data-drupal-url-preview"))return;i.setAttribute("data-drupal-url-preview","loading",l)}else l=i.createRawElement("div",{"data-drupal-url-preview":"loading"}),i.insert(i.createPositionAt(o,0),l);this._loadPreview(n).then((({label:e,preview:t})=>{l&&this.editor.editing.view.change((r=>{const i=r.createRawElement("div",{"data-drupal-url-preview":"ready","aria-label":e},(e=>{e.innerHTML=t}));r.insert(r.createPositionBefore(l),i),r.remove(l)}))}))})),e))),Object.keys(this.attrs).forEach((t=>{const r={model:{key:t,name:"drupalUrl"},view:{name:"drupal-url",key:this.attrs[t]}};e.for("dataDowncast").attributeToAttribute(r),e.for("upcast").attributeToAttribute(r)}))}async _loadPreview(e){const t={text:this._renderElement(e)},r=await fetch(Drupal.url("embed/preview/"+this.options.format+"?"+new URLSearchParams(t)),{headers:{"X-Drupal-EmbedPreview-CSRF-Token":this.options.previewCsrfToken}});if(r.ok){return{label:Drupal.t("Url Embed widget"),preview:await r.text()}}return{label:this.labelError,preview:this.previewError}}_renderElement(e){const t=this.editor.model.change((t=>{const r=t.createDocumentFragment(),i=t.cloneElement(e,!1);return t.append(i,r),r}));return this.editor.data.stringify(t)}_getPreviewContainer(e){for(const t of e){if(t.hasAttribute("data-drupal-url-preview"))return t;if(t.childCount){const e=this._getPreviewContainer(t.getChildren());if(e)return e}}return null}}var l=r("ckeditor5/src/ui.js");class s extends e.Plugin{init(){const e=this.editor,t=this.editor.config.get("urlEmbed");if(!t)return;const{dialogURL:r,openDialog:i,dialogSettings:n={}}=t;r&&"function"==typeof i&&e.ui.componentFactory.add("urlembed",(t=>{const o=e.commands.get("urlembed"),s=new l.ButtonView(t);return s.set({label:Drupal.t("Url Embed"),icon:'\x3c!-- Generated by IcoMoon.io --\x3e\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">\n<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.394-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.121 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841v0 0zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268v0 0zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>\n<path d="M8 16h10v10h-10v-10z"></path>\n<path d="M18 20l6-4v10l-6-4z"></path>\n</svg>\n',tooltip:!0}),s.bind("isOn","isEnabled").to(o,"value","isEnabled"),this.listenTo(s,"execute",(()=>{let t={};const{model:o}=this.editor,l=function(e){const t=e.getSelectedElement();return r=t,r&&r.is("element","drupalUrl")?t:e.getFirstPosition().findAncestor("drupalUrl");var r}(o.document.selection);l&&(t={url_element:l.getAttribute("url")}),i(`${r}?${new URLSearchParams(t)}`,(({attributes:t})=>{e.execute("urlembed",t)}),n)})),s}))}}class d extends e.Plugin{static get requires(){return[o,s]}static get pluginName(){return"UrlEmbed"}}const a={UrlEmbed:d}})(),i=i.default})()));